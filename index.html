<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link
      rel="icon"
      type="image/svg+xml"
      href="/hiring-dog-logo.png"
    />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0"
    />
    <link
      rel="preconnect"
      href="https://fonts.googleapis.com"
    />
    <link
      rel="preconnect"
      href="https://fonts.gstatic.com"
      crossorigin
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap"
      rel="stylesheet"
    />
    <title>HD Interview Platform</title>

    <!-- Tawk.to Script with conditional initialization -->
    <script type="text/javascript">
      // Initial setup - will be updated dynamically
      var Tawk_API = Tawk_API || {};
      var Tawk_LoadStart = new Date();

      // Check session storage for user information
      function updateTawkBasedOnAuth() {
        var tawkUserInfo =
          sessionStorage.getItem("tawkUserInfo");

        if (tawkUserInfo) {
          try {
            var userInfo = JSON.parse(tawkUserInfo);

            // Check if user has required role
            if (userInfo.isAllowed) {
              // Set visitor name if available
              if (userInfo.name) {
                Tawk_API.visitor = {
                  name: userInfo.name,
                };
              }

              // Load the Tawk.to script if not already loaded
              if (
                !document.getElementById(
                  "tawkto-widget-script"
                )
              ) {
                var s1 = document.createElement("script");
                s1.async = true;
                s1.src =
                  "https://embed.tawk.to/681874f8475f9d1909b7eccf/1iqfohro0";
                s1.charset = "UTF-8";
                s1.setAttribute("crossorigin", "*");
                s1.id = "tawkto-widget-script";

                // After script loads, show the widget
                s1.onload = function () {
                  setTimeout(function () {
                    if (Tawk_API.showWidget) {
                      Tawk_API.showWidget();
                      Tawk_API.start();
                    }
                  }, 1000);
                };

                document.head.appendChild(s1);
              } else if (Tawk_API.showWidget) {
                // Script already loaded, just show widget
                Tawk_API.showWidget();
                Tawk_API.start();
              }
            } else {
              // Hide widget for unauthorized users
              if (Tawk_API.hideWidget) {
                Tawk_API.hideWidget();
              }
            }
          } catch (e) {
            // Handle error silently in production
          }
        }
      }

      // Run check on page load
      document.addEventListener(
        "DOMContentLoaded",
        updateTawkBasedOnAuth
      );

      // Listen for auth changes
      window.addEventListener(
        "tawkInfoUpdated",
        updateTawkBasedOnAuth
      );
    </script>
  </head>
  <body style="font-family: 'Roboto', sans-serif">
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>
